# Recon MCP - ネットワークスキャンツール

Recon MCPは、Claude DesktopとDockerを活用した高度なネットワークスキャンツールです。
nmapを使用してターゲットシステムのスキャンとWEBサイトの隠しディレクトリを探索し、
Claude Desktopの知識ベースを活用して脆弱性情報と対策を提供します。

## 特徴

- Claude Desktopとの統合による高度な脆弱性分析
- Dockerコンテナによる安全で効率的なスキャン環境
- 包括的なポートスキャンとサービス検出
- Webサイトの隠しディレクトリ探索
- サブドメインの自動探索
- 脆弱性データベース（Exploit-DB/NVD）連携によるバージョン脆弱性自動検索
- OSINT調査
- 日本語での詳細なレポート出力

## 機能の説明

### 1. Nmapスキャン
- ポートスキャン、サービス検出、バージョン検出が可能です。
- 例：
  - 基本スキャン（開放ポートの検出）
  - 詳細スキャン（バージョン検出、指定ポートのみ）
  - 特定ポートのスキャン

### 2. Webスキャン
- WebサイトのHTTPヘッダーやセキュリティヘッダーの確認、robots.txtの取得、技術検出、ディレクトリスキャンが可能です。
- 例：
  - Webサーバーの情報収集
  - ディレクトリ・ファイルスキャン
  - 使用技術（CMS/フレームワーク等）の検出

### 3. DNS調査
- ドメインのDNSレコード取得、サブドメイン列挙、逆引きDNSなどが可能です。
- 例：
  - A/MX/NS/TXTレコードの取得
  - サブドメインの自動探索
  - 逆引きDNS

### 5. OSINT調査
- 対象IPやドメインに関する公開情報（OSINT）を自動収集します。
- 例：
  - Whois情報、DNS、公開データベースの調査

### 6. サービス分析
- Nmapや他のスキャン結果をもとに、サービスごとのセキュリティ分析を行います。
- 例：
  - サービスのリスク評価
  - 推奨対策の提示

### 7. FTP匿名ログインスキャン
- FTPサーバーの匿名ログイン機能をテストし、セキュリティリスクを分析します。
- 例：
  - FTPサーバーのバナー情報取得
  - 匿名ログインの可否確認
  - アクセス可能なファイル・ディレクトリの列挙
  - セキュリティ問題の特定と推奨対策

### 8. レポート生成
- スキャン結果や分析内容を日本語で分かりやすくレポートとして出力します。
- 例：
  - スキャンごとの詳細レポート

## 必要条件

- Claude Desktop
- Docker

## セットアップ手順

1. Claude Desktopをインストール

2. このリポジトリをクローン：
```bash
git clone https://github.com/yourusername/recon-mcp.git
cd recon-mcp
```

3. **Dockerイメージのビルド**：
```bash
# 基本的なビルド
docker build -t recon-mcp .

# タグ付きでビルド
docker build -t recon-mcp:latest .

# キャッシュを使わずにビルド（問題がある場合）
docker build --no-cache -t recon-mcp .

# ビルドログを詳細に表示
docker build --progress=plain -t recon-mcp .
```

4. **Claude Desktop設定ファイルの配置**：

   **基本設定（ボリュームマウントなし）**：
   - `Claude/claude_desktop_config.json` を以下のパスにコピー：
   ```
   C:\Users\<ユーザー名>\AppData\Roaming\Claude\claude_desktop_config.json
   ```

   **ボリュームマウント付き設定（推奨）**：
   - `Claude/claude_desktop_config_with_volume.json` を以下のパスにコピー：
   ```
   C:\Users\<ユーザー名>\AppData\Roaming\Claude\claude_desktop_config.json
   ```
   - ファイル内のパスを実際のパスに変更：
   ```json
   "C:/<path to your directory>/reports:/app/reports"
   ```
   を以下に変更：
   ```json
   "C:/Users/naoki/Documents/GitHub/recon-mcp/reports:/app/reports"
   ```
   - ホストマシンに `reports` ディレクトリを作成：
   ```bash
   mkdir reports
   ```

### Dockerビルドの詳細

#### ビルド内容
- **ベースイメージ**: Python 3.11-slim
- **インストールツール**: nmap、dnsutils、curl、その他のセキュリティツール
- **Python依存関係**: anthropic、mcp、playwright、その他のセキュリティライブラリ
- **セキュリティ設定**: 非rootユーザー（recon）で実行

#### ビルド時の注意事項
- ビルドには時間がかかる場合があります（特にPlaywrightのブラウザインストール）
- インターネット接続が必要です
- 十分なディスク容量を確保してください（約2-3GB）

#### ビルド後の実行方法
```bash
# 基本的な実行
docker run -it recon-mcp

# ポートマッピング付きで実行
docker run -it -p 8000:8000 recon-mcp

# ボリュームマウント付きで実行（レポート保存用）
docker run -it -v $(pwd)/reports:/app/reports recon-mcp
```

## 使用方法

### 基本的な使用
1. Dockerイメージをビルド（上記手順3を参照）
2. Claude Desktopを起動
3. 以下のような形式で質問を入力：
```
<対象IPアドレス>をスキャンして
```

### スキャンの種類

1. **基本スキャン**：
```
<対象IPアドレス>の基本的なポートスキャンをして
```
- 開放ポートの検出のみ（バージョン情報なし）

2. **詳細スキャン**：
```
<対象IPアドレス>のサービスバージョンを詳しく調べて
```
- **注意**: ポート指定が必須です

3. **特定ポートのスキャン**：
```
<対象IPアドレス>の80番と443番ポートをスキャンして
```

4. **ディレクトリスキャン**：
```
<URL>のディレクトリスキャンをして
```

5. **サブドメインスキャン**：
```
<ドメイン>のサブドメインを探索して
```

6. **OSINT調査**：
```
<対象IPアドレス>のOSINT調査をして
```

7. **FTP匿名ログインスキャン**：
```
<対象IPアドレス>のFTP匿名ログインをテストして
```

### スキャンの流れ

#### 推奨されるスキャン手順：

1. **基本スキャンで開放ポートを特定**：
   ```
   nmap_basic_scan("192.168.1.1")
   ```

2. **結果から開放ポートを確認**：
   ```
   開放ポート: 22, 80, 443
   ```

3. **詳細スキャンでバージョン情報を取得**：
   ```
   nmap_detailed_scan("192.168.1.1", "22,80,443")
   ```

### 例
```
http://example.com/のディレクトリを探索して
example.comのサブドメインを探して
example.comのOSINT調査をして
192.168.1.100のFTP匿名ログインをテストして
```

### 注意事項
- VPN経由でのスキャンはホストでVPN接続をして実行をしてください。
- スキャンは必ず許可された環境でのみ実行してください
- 本番環境での使用は避け、テスト環境で実施してください
- スキャン結果には機密情報が含まれる可能性があるため、適切に管理してください
- ディレクトリスキャンは対象サイトに負荷をかける可能性があります
- サブドメインスキャンはDNSサーバーに負荷をかける可能性があります
- **詳細スキャンはポート指定が必須です**。基本スキャンで開放ポートを確認してから実行してください。

## 制限事項

- スキャンのタイムアウト：5分
- ディレクトリスキャンのタイムアウト：10分
- サブドメインスキャンのタイムアウト：5分
- 同時スキャン数：1つのスキャンのみ実行可能
- 詳細スキャン：ポート指定が必須
- FTPスキャン：タイムアウト10秒

## ライセンス

MITライセンス

## 連絡先

問題や提案がありましたら、GitHubのIssueを作成してください。
